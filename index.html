<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" type="image/x-icon" href="images/logo.webp" />
        <link rel="stylesheet" href="css/style_index.css" />
        <title>NextStep</title>
    </head>
    <body>
        <div class="navbar">
            <div class="brand-name">NextStep</div>
            <div class="nav-buttons">
                <button>Settings</button>
                <button>Map</button>
                <button>Sign out</button>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn" onclick="openSearchModal()">
                üîç Search & Filter
            </button>
            <div class="workflow-indicator">‚Üí</div>
            <button
                class="action-btn"
                id="composeBtn"
                onclick="openEmailModal()"
                disabled
            >
                ‚úâÔ∏è Compose Email (<span id="selectedCount">0</span> selected)
            </button>
        </div>

        <div class="content-container">
            <div class="table-section">
                <div class="table-header">
                    <div class="selected-info">
                        <span id="totalCount">10</span> records |
                        <span id="selectedCountText">0</span> selected
                    </div>
                    <div class="select-all-container">
                        <input
                            type="checkbox"
                            id="selectAll"
                            onchange="toggleSelectAll()"
                        />
                        <label for="selectAll">Select All</label>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Select</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>John Doe</td>
                                <td>john@example.com</td>
                                <td>
                                    <span class="status-badge status-active"
                                        >Active</span
                                    >
                                </td>
                                <td>2025-09-20</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Jane Smith</td>
                                <td>jane@example.com</td>
                                <td>
                                    <span class="status-badge status-pending"
                                        >Pending</span
                                    >
                                </td>
                                <td>2025-09-19</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Bob Johnson</td>
                                <td>bob@example.com</td>
                                <td>
                                    <span class="status-badge status-active"
                                        >Active</span
                                    >
                                </td>
                                <td>2025-09-18</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Alice Williams</td>
                                <td>alice@example.com</td>
                                <td>
                                    <span class="status-badge status-inactive"
                                        >Inactive</span
                                    >
                                </td>
                                <td>2025-09-17</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Charlie Brown</td>
                                <td>charlie@example.com</td>
                                <td>
                                    <span class="status-badge status-active"
                                        >Active</span
                                    >
                                </td>
                                <td>2025-09-16</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Diana Prince</td>
                                <td>diana@example.com</td>
                                <td>
                                    <span class="status-badge status-pending"
                                        >Pending</span
                                    >
                                </td>
                                <td>2025-09-15</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Frank Miller</td>
                                <td>frank@example.com</td>
                                <td>
                                    <span class="status-badge status-active"
                                        >Active</span
                                    >
                                </td>
                                <td>2025-09-14</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Grace Lee</td>
                                <td>grace@example.com</td>
                                <td>
                                    <span class="status-badge status-inactive"
                                        >Inactive</span
                                    >
                                </td>
                                <td>2025-09-13</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Mike Wilson</td>
                                <td>mike@example.com</td>
                                <td>
                                    <span class="status-badge status-active"
                                        >Active</span
                                    >
                                </td>
                                <td>2025-09-12</td>
                            </tr>
                            <tr>
                                <td>
                                    <input
                                        type="checkbox"
                                        onchange="updateSelection()"
                                    />
                                </td>
                                <td>Sarah Connor</td>
                                <td>sarah@example.com</td>
                                <td>
                                    <span class="status-badge status-pending"
                                        >Pending</span
                                    >
                                </td>
                                <td>2025-09-11</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Search Modal -->
        <div class="modal" id="searchModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Search & Filter Records</h2>
                    <button class="close-btn" onclick="closeSearchModal()">
                        &times;
                    </button>
                </div>
                <form class="search-form" id="searchForm">
                    <div class="form-group">
                        <label for="searchQuery">Search:</label>
                        <input
                            type="text"
                            id="searchQuery"
                            placeholder="Search by name or email..."
                        />
                    </div>
                    <div class="search-row">
                        <div class="form-group">
                            <label for="statusFilter">Status:</label>
                            <select id="statusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active Users</option>
                                <option value="pending">Pending Users</option>
                                <option value="inactive">Inactive Users</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sortBy">Sort By:</label>
                            <select id="sortBy">
                                <option value="date">
                                    Date (Latest First)
                                </option>
                                <option value="name">Name (A-Z)</option>
                                <option value="email">Email (A-Z)</option>
                                <option value="status">Status</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            onclick="clearFilters()"
                        >
                            Clear Filters
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Apply Filters
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal" id="emailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Compose Email to Selected Recipients</h2>
                    <button class="close-btn" onclick="closeEmailModal()">
                        &times;
                    </button>
                </div>
                <div class="recipients-info">
                    <h4>Email will be sent to:</h4>
                    <div class="recipients-list" id="recipientsList">
                        No recipients selected
                    </div>
                </div>
                <form id="emailForm">
                    <div class="form-group">
                        <label for="emailSubject">Subject:</label>
                        <input
                            type="text"
                            id="emailSubject"
                            placeholder="Enter email subject"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="emailMessage">Message:</label>
                        <textarea
                            id="emailMessage"
                            placeholder="Compose your email message here..."
                            required
                        ></textarea>
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            onclick="closeEmailModal()"
                        >
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Send to <span id="sendCount">0</span> Recipients
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            let allData = [
                {
                    name: "John Doe",
                    email: "john@example.com",
                    status: "active",
                    date: "2025-09-20",
                },
                {
                    name: "Jane Smith",
                    email: "jane@example.com",
                    status: "pending",
                    date: "2025-09-19",
                },
                {
                    name: "Bob Johnson",
                    email: "bob@example.com",
                    status: "active",
                    date: "2025-09-18",
                },
                {
                    name: "Alice Williams",
                    email: "alice@example.com",
                    status: "inactive",
                    date: "2025-09-17",
                },
                {
                    name: "Charlie Brown",
                    email: "charlie@example.com",
                    status: "active",
                    date: "2025-09-16",
                },
                {
                    name: "Diana Prince",
                    email: "diana@example.com",
                    status: "pending",
                    date: "2025-09-15",
                },
                {
                    name: "Frank Miller",
                    email: "frank@example.com",
                    status: "active",
                    date: "2025-09-14",
                },
                {
                    name: "Grace Lee",
                    email: "grace@example.com",
                    status: "inactive",
                    date: "2025-09-13",
                },
                {
                    name: "Mike Wilson",
                    email: "mike@example.com",
                    status: "active",
                    date: "2025-09-12",
                },
                {
                    name: "Sarah Connor",
                    email: "sarah@example.com",
                    status: "pending",
                    date: "2025-09-11",
                },
            ];

            let filteredData = [...allData];

            // Selection management
            function updateSelection() {
                const checkboxes = document.querySelectorAll(
                    '#tableBody input[type="checkbox"]',
                );
                const selectedCount = Array.from(checkboxes).filter(
                    (cb) => cb.checked,
                ).length;

                document.getElementById("selectedCount").textContent =
                    selectedCount;
                document.getElementById("selectedCountText").textContent =
                    selectedCount;
                document.getElementById("composeBtn").disabled =
                    selectedCount === 0;

                // Update row highlighting
                checkboxes.forEach((checkbox, index) => {
                    const row = checkbox.closest("tr");
                    if (checkbox.checked) {
                        row.classList.add("selected");
                    } else {
                        row.classList.remove("selected");
                    }
                });

                // Update select all checkbox
                const selectAllCheckbox = document.getElementById("selectAll");
                if (selectedCount === 0) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = false;
                } else if (selectedCount === checkboxes.length) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = true;
                } else {
                    selectAllCheckbox.indeterminate = true;
                }
            }

            function toggleSelectAll() {
                const selectAll = document.getElementById("selectAll");
                const checkboxes = document.querySelectorAll(
                    '#tableBody input[type="checkbox"]',
                );

                checkboxes.forEach((checkbox) => {
                    checkbox.checked = selectAll.checked;
                });

                updateSelection();
            }

            // Modal functions
            function openSearchModal() {
                document.getElementById("searchModal").classList.add("active");
            }

            function closeSearchModal() {
                document
                    .getElementById("searchModal")
                    .classList.remove("active");
            }

            function openEmailModal() {
                const selectedEmails = getSelectedRecipients();
                if (selectedEmails.length === 0) {
                    alert(
                        "Please select recipients first by using Search & Filter, then checking the boxes next to the people you want to email.",
                    );
                    return;
                }

                updateRecipientsDisplay();
                document.getElementById("emailModal").classList.add("active");
            }

            function closeEmailModal() {
                document
                    .getElementById("emailModal")
                    .classList.remove("active");
            }

            function getSelectedRecipients() {
                const checkboxes = document.querySelectorAll(
                    '#tableBody input[type="checkbox"]:checked',
                );
                const recipients = [];

                checkboxes.forEach((checkbox) => {
                    const row = checkbox.closest("tr");
                    const cells = row.querySelectorAll("td");
                    recipients.push({
                        name: cells[1].textContent,
                        email: cells[2].textContent,
                    });
                });

                return recipients;
            }

            function updateRecipientsDisplay() {
                const recipients = getSelectedRecipients();
                const recipientsList =
                    document.getElementById("recipientsList");
                const sendCount = document.getElementById("sendCount");

                if (recipients.length === 0) {
                    recipientsList.textContent = "No recipients selected";
                } else {
                    recipientsList.innerHTML = recipients
                        .map((r) => `‚Ä¢ ${r.name} (${r.email})`)
                        .join("<br>");
                }

                sendCount.textContent = recipients.length;
            }

            function renderTable(data) {
                const tableBody = document.getElementById("tableBody");
                tableBody.innerHTML = "";

                data.forEach((person) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
          <td><input type="checkbox" onchange="updateSelection()"></td>
          <td>${person.name}</td>
          <td>${person.email}</td>
          <td><span class="status-badge status-${person.status}">${person.status.charAt(0).toUpperCase() + person.status.slice(1)}</span></td>
          <td>${person.date}</td>
        `;
                    tableBody.appendChild(row);
                });

                document.getElementById("totalCount").textContent = data.length;
                updateSelection();
            }

            function clearFilters() {
                document.getElementById("searchQuery").value = "";
                document.getElementById("statusFilter").value = "";
                document.getElementById("sortBy").value = "date";
                filteredData = [...allData];
                renderTable(filteredData);
            }

            // Event listeners
            document
                .getElementById("searchForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();

                    const searchQuery = document
                        .getElementById("searchQuery")
                        .value.toLowerCase();
                    const statusFilter =
                        document.getElementById("statusFilter").value;
                    const sortBy = document.getElementById("sortBy").value;

                    // Filter data
                    filteredData = allData.filter((person) => {
                        const matchesSearch =
                            person.name.toLowerCase().includes(searchQuery) ||
                            person.email.toLowerCase().includes(searchQuery);
                        const matchesStatus =
                            !statusFilter || person.status === statusFilter;
                        return matchesSearch && matchesStatus;
                    });

                    // Sort data
                    filteredData.sort((a, b) => {
                        switch (sortBy) {
                            case "name":
                                return a.name.localeCompare(b.name);
                            case "email":
                                return a.email.localeCompare(b.email);
                            case "status":
                                return a.status.localeCompare(b.status);
                            case "date":
                            default:
                                return new Date(b.date) - new Date(a.date);
                        }
                    });

                    renderTable(filteredData);
                    closeSearchModal();
                    alert(
                        `Found ${filteredData.length} records matching your criteria`,
                    );
                });

            document
                .getElementById("emailForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    const recipients = getSelectedRecipients();
                    const subject =
                        document.getElementById("emailSubject").value;
                    const message =
                        document.getElementById("emailMessage").value;

                    alert(
                        `Email "${subject}" sent successfully to ${recipients.length} recipients!`,
                    );
                    closeEmailModal();
                    this.reset();

                    // Clear selections after sending
                    document
                        .querySelectorAll('#tableBody input[type="checkbox"]')
                        .forEach((cb) => (cb.checked = false));
                    updateSelection();
                });

            // Close modals when clicking outside
            document.addEventListener("click", function (event) {
                const emailModal = document.getElementById("emailModal");
                const searchModal = document.getElementById("searchModal");

                if (event.target === emailModal) {
                    closeEmailModal();
                }

                if (event.target === searchModal) {
                    closeSearchModal();
                }
            });

            // Initialize
            document.addEventListener("DOMContentLoaded", function () {
                renderTable(allData);
            });
        </script>
    </body>
</html>
